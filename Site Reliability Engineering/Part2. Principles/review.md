# 원리 (Principles)
이 섹션에서는 SRE 팀이 일반적으로 어떻게 일하는지를 뒷받침하는 원칙들—SRE 운영의 일반적인 영역에 영향을 미치는 패턴, 행동, 그리고 관심사들을—살펴본다.

--------------------

## 리스크 포용하기 (Embracing Risk)
SRE 는 넓은 시야에서 보면 에러 버짓이라는 수단을 사용해서 위험을 평가하고 수용하는 엔지니어링 방식이다.

### Managing Risk
리스크 관리에 관하여, 서비스의 신뢰성을 관리한다는 것은 리스크를 관리한다는 것이다. 
100% 가용성은 달성 불가능하고 유저가 원하지도, 알아 챌 수도 없다. (수치가 커질수록 달성을 위한 비용은 기하급수적으로 증가한다.)
따라서 서비스를 충분히 신뢰성 있게 만들되, 그 이상으로 만들지 않도록 한다.

### Measuring Service Risk
구글에서는 시스템의 특성을 대표할 수 있는 객관적인 지표를 식별해 내어서 목표를 설정함으로써 성능을 평가하고 변화를 추적한다.
하지만 리스크의 경우 여러 요인을 하나의 지표로 다루기는 힘들다.
다양한 시스템유형에 대해서 실용적이고 일관되게 다루기 위해서 구글은 예기치 않은 다운타임에 unplanned downtime 에 초점을 맞춘다.
time-based availability 라는 측정장법이 있지만 구글에서는 리퀘스트의 성공비율을 나타내는 aggregate availability 를 사용한다.  
```
availablity = successful requests / total requests
```
어플리케이션에서 각 리퀘스트의 중요도는 다르지만 요청의 성공률로 계산된 가용성은 사용자 관점에서 보는 다운타임을 합리적으로 근사하는 지표가 될 수 있다.
이 지표는 사용자에게 직접 서비스를 제공하지 않는 시스템에도 적용할 수 있고 이때, 리퀘스트의 성공과 실패 명확하게 정의되어 있다.
구글에서는 분기별로 서비스의 가용성 목표를 설정하고 실제 성과를 매주 또는 매일 추적한다.  

### Risk Tolerance of Services
서비스의 위험 감수 한계 밝혀 낸다는 것은 서비스가 어느정도 실패를 허용할 수 있는지 밝혀내는 것으로 비지니스와 관련이 있다.
이는 비지니스 목표를 기반으로 엔지니어링 목표가 될 수 있는 명시적인 서비스 제공 수준을 만들어 내는 것을 의미한다.
서비스의 위험 감수 한계를 평하할 때 목표 가용성 수준, 실패의 종류, 비용을 고려해야 한다.
커스터머 서비스와 인프라스트럭쳐 서비스의 위험 내성의 양상은 조금 다르다.

#### Identifying the Risk Tolerance of Consumer Services
커스터머 서비스(ex, 구글맵, 구글독)에서는 제품개발팀의 비지니스 오너로 활동한다. 
프러덕트 메니저는 마켓 플레이스에서 프러덕트의 성공을 위해 유저와 비지니스에 대해서 이해할 책임이 있는데, 프러덕트 팀에서 신뢰성 요구사항을 논의한다.

목표 가용성 수준: 경쟁서비스 서비스의 유무료 여부 등에 따라서 결정된다.
실패의 종류: 데이터의 종류에 따라 취해야 하는 행동이 달라진다. 개인정보와 관련된 실패는 장애 기간이 길어지더라도 철저한 점검이 필요하다.
비용: 신뢰성과 그에 따른 수익을 비교해서 신뢰성을 올리는데 필요한 비용이, 신뢰성을 올렸을 때 발생하는 추가적인 수익보다 적다면 시도해 볼만하다. 
하지만 이러한 신뢰성과 수익에 대한 함수 도출은 쉽지 않다.
다른 메트릭: 가용성을 제외한 메트릭도 위험 감수 한계를 평가할 때 도움이 될 수 있다. 예를들어 어떤 서비스는 지연시간이 중요하지만, 다른 서비스에서는 중요하지 않다.
느슨한 지연시간 요구사항을 밝혀내면 운영비용을 절감 할 수 있다. 

#### Identifying the Risk Tolerance of Infrastructure Services
인프라스트럭처 서비스는 인프라스트럭쳐 서비스(ex, 빅테이블)의 경우 클라이언트가 다양하고 요구사항도 다양하다. 
예를들어 산출량이 중요한 유저도 있고, 지연시간이 중요한 유저도 있다.
저지연을 요구하는 사용자는 요청 큐가 계속해서 비어있기를 원하고 , 산출량을 원하는 사용자 전체 처리의 효율성을 위해서 항상 큐가 가득차 있기을 원한다.
이처럼 상반된 목표를 가지고 있는 경우.
서로 다른 요구사항을 만족하는 복수의 클러스터로 서비스 수준을 제공하는것으로 이 문제를 해결 할 수 있다.

### Motivation for Error Budgets (오류 예산의 도입 배경)

제품 개발팀의 실적은 얼마나 빨리 새로운 기능을 출시하는 것이다. 반면 SRE 의 실적은 신뢰성에 기반된다.
새로운 기능의 출시는 신뢰성을 떨어뜨리고 이 두 동기는 충돌한다.
 
결국 기능의 출시 속도는 두팀의 협상 결과로 비공식적인 균형에 의해 정해지나, 이것이 최적화 되었는지는 알 수 없다.
구글에서는 목표는 두 팀의 동의하는 객관적인 지표 정해서 재현가능한 방식으로 협상을 이끄는데 그 지표를 사용하는 것이다.
결정은 데이터에 기반할 수록 좋다.

#### Forming Your Error Budget
객관적인 데이터를 통해 의사결정을 하기 위해서 두팀은 분기별로 SLO 와 오류예산을 공동으로 정의한다.
이 지표를 사용함으로써 허용가능한 리스크의 수준을 합리적으로 정할 수 있다.
예를들면 오류예산은 다음과 같이 활용 될 수 있다.
한 분기의 요청 성공률의 SLO 99.999% 인 경우 오류예산은 0.001% 이다.
만약 어떤 문제가 한 분기의 예상쿼리의 0.0002% 를 실패하게 만든다면 오류예산은 20% 가 사용된 것이다.

#### Benefits
오류예산 SRE 와 제품 개발팀의 동인을 일치 시키고 공동의 소유권을 강조한다.
제품 개발팀은 오류예산을 활용한 제어 루프를 통해 릴리즈 속도를 조절한다.
즉 SLO 가 충족되는한 릴리즈는 계속 될 수 있다.
제품 개발팀은 계속해서 새로운 기능을 릴리즈하기 위해서라도 신뢰성을 고려하게 된다.
에러 버짓은 구체적인 수치로써 여러 팀에 걸쳐서 의사소통을 원할하게 하며 출시 속도를 결정하는데 도움을 준다.

--------------------

## 서비스 수준 목표 (Service Level Objectives)

서비스에 있어 진정으로 중요한 동작이 무엇인지, 그리고 그것을 어떻게 측정하고 평가할지를 이해하지 못한다면 서비스를 제대로 관리하는 것은 불가능하다. 
이러한 목적을 달성하기 위해, 내부 API를 사용하든 공개된 제품을 사용하든 상관없이 사용자에게 특정 수준의 서비스를 정의하고 제공해야 한다.

직관, 경험, 그리고 사용자가 원하는 바에 대한 이해를 바탕으로 서비스 수준 지표(SLI), 목표(SLO), 그리고 계약(SLA)를 정의한다. 
이러한 측정 기준은 중요한 메트릭의 기본 속성, 그 메트릭이 가져야 할 값, 그리고 기대한 수준의 서비스를 제공하지 못할 경우의 대응 방안을 설명한다. 
궁극적으로 적절한 메트릭을 선택하는 것은 문제가 발생했을 때 올바른 조치를 유도하며, SRE 팀이 서비스가 정상적으로 운영되고 있음을 확신할 수 있도록 도움을 준다.

### Service Level Terminology
#### Indicators(지표)
SLI 는 제공 되는 서비스 수준의 어떤 측면을 정밀하게 정의한 정량적인 측정(measure) 이다. (척도가 아니라 측정값 그 자체를 말하는듯)
측정값들은 종종 비율, 평균 등으로 집약된다. 
availability 는 SLI 중에 하나 이다.

#### Objectives(목표)
SLO 는 SLI 로써 측정된 서비스 수준에 대한 목표 값 이다.
목표값은 다음 처럼 나타난다. SLI ≤ target
SLO 를 공개하는 것으로 유저가 서비스에대한 자신의 믿음을 만들어내는 것을 방지할 수 있다.

※ Chubby 케이스 스터디: SLO 를 과도하게 초과해서 Chubby 에 장애가 생기 지않을 거라는 잘못된 믿음이 생겼다. 
SLO 를 달성하는 수준에서 의도적으로 장애를 만듬으로써 이러한 비합리적인 의존을 제거할 수 있었다.

#### Agreements
SLA 는 SLO 가 충족되거나 그러지 못했을 경우의 결과를 포함 하고 있는 유저와의 계약이다.
Google Search 는 SLA 가 없다. 

### Indicators in Practice (지표의 적용사례)

#### What Do You and Your Users Care About?
모니터링 시스템의 모든 수치를 SLI 로 사용할 수는 없다. 사용자들이 무엇을 원하는지 이해해서 지표를 신중하게 선택해야,
적절하게 지표들에 주의를 기울일 수 있다.
소수의 대표적인 지표만으로도 시스템의 상태를 평가하는데 충분하다. 

서비스들은 중요하게 여기는 SLI의 관점에서 몇 가지 넓은 범주로 나뉘는 경향이 있다:
- 유저와 접하는 시스템: availability, latency, throughput
- 스토리지 시스템: latency, availability, durability
- 빅데이터 시스템(데이터 프로세싱 파이프라인): throughput, end-to-end latency
- 모든 시스템: correctness(정확성), 단 이것은 SRE 과 관리하는 지표는 아니다.

#### Collecting Indicators
대부분 서버사이드에서 측정하지만, 이것으로 드러나지 않는 문제도 있기때문에 일부 시스템은 클라이언트 측에서도 측정해야 한다.

#### Aggregation (집계)
단순함과 사용성을 위해서 낮은 레벨의 측정을 집계한다. Request per Second 같은 단순한 지표도, 측정 창(1 Second) 안에서의 데이터의 집계이다.
매 짝수초마다 200 개의 요청이 있는 서버와, 매초마다 100 개의 요청이 있는 서버의 RPS는 같으나 전자가 동시에 일어나는 요청이 더 크다.
이처럼 평균값을 사용하는 것은 맹점이 있으며, 분포(distributions) 를 사용하는 것이 더 바람직 하다.

#### Standardize Indicators (지표 표준화)
SLI 에 대해서 공통의 정의를 표준화 해야한다. 재사용 가능한 SLI 의 템플릿을 만들어서 사용하는 것도 좋다.



## 반복작업 제거하기 (Eliminating Toil)
SRE 의 가장 중요한 일중 하나는 귀찮은일을 제거하는 것 이다. 
SRE 는 toil 을 서비스가 성장할때 리니어하게 증가하는, 오래 지속되는 가치를 만들지 않는 반복적인 운영업무를 의미한다.  

## 분산시스템 감시 (Monitoring Distributed Systems)
모니터를 하지 않으면 시스템에 무슨일이 일어나는지 알 수 없다.  

## 구글에서의 자동화의 진화 (The Evolution of Automation at Google)

## 릴리즈 엔지니어링 (Release Engineering)

## 단순함 (Simplicity)
잘 작동하는 복잡한 시스템은 반드시 잘 작동하는 단순한 시스템에서 진화해온 것이다.





