
# Reliable Product Launches at Scale
## Santa was coming
전세계의 어린아이들에게 산타의 이동경로를 보여주는 프로젝트의 런칭은 매우 도전적이었고 이를 LCE가 담당했다.
인터넷 회사는 다른 일반적인 소프트웨어 회사외 다르게 새로운 제품이나 기능을 서버에 출시하기 때문에 런치가 더 쉽고 그 빈도가 훨씬 많다.
이것은 간소화된 런치 프로세스를 창조하는 것에 대한 근거 및 기회가 되었다.
거꾸로 생각해보면 아주 낮은 빈도의 런치를 가지는 회사는 이러한 프로세스가 항상 구식이 되기 때문에 필요 없으며, 이러한 프로세스를 개발하기 위한 경험을 쌓을 수도 없다.

# Launch Coordination Engineering
프러덕트의 엔지니어는 프러덕트 자체에 대해서는 잘 알고 있지만, 수십만의 유저에게 프러덕트를 릴리즈 할 때의 함정과 도전에는 친숙하지 않을 수 있다.
런칭이 내제하고 있는 이러한 문제를 해결하기 위해서 구글은 LCE 라는 전담 팀을 조직했다.
이 팀은 구글의 견고함, 안정성, 확장성에 대한 구굴의 표준을 준수하도록 가이드 한다.
프러덕트 릴리즈에 이미 SRE 가 개입하고 있을 때도, 운영과 런칭은 다름으로 LCE가 런칭에는 개입하기도 한다.

## The Role of the Launch Coordination Engineer
LCE는 SRE 안의 하나의 롤 로써 다음과 같은 이점을 제공한다.
- 넓은 경험: 거의 모든 구글 프러덕트에 관여하기 때문에 프러덕트를 가로지르는 지식을 가지고 있고, 이는 이들을 지식 전파자로 만든다.
- 기능을 가로지르는 관점: LCE는 SRE, 개발, 프러덕트 관리에 걸쳐, 런치에 관해서 전체적인 관점을 가진다.
- 객관성: 다양한 이해관계자들 사이에서 중립적인 입장에서 조장자 역할을 한다.

# Setting Up a Launch Process
좋은 런치 프로세스에 관해서 다음과 같은 기준을 만들었다.
- 경량: 개발자에게 쉬워야 한다.
- 튼틈함: 명백하게 에러들을 잡아내야 한다.
- 철저함: 반복적이고 일관적이게 중요한 디테일들을 다뤄야 한다.
- 확장용이: 많은 수의 단순한 런치, 적은 수의 복잡한 런치 모두를 수용해야한다.
- 조정용이: 일반적인 타입의 런치와 새로운 타입의 런치 모두에서 잘 동작해야 한다. 

경량과 철저함은 충돌하는 기준이라 지속적으로 적절히 조절해야 한다.
이것을 달성하기 위해서 아래와 같은 전략을 사용한다.

- 단순함: 기본적인게 옳다. 모든 상황에 대비하지 않는다.
- 개별요구에 맞추기: 경험있는 엔지니어가 각 런치에 맞추기 위해서 프로세스를 커스터마이즈화 한다.
- 빠른 공통 경로: 항상 일반적인 패턴을 따르는 런치의 종류를 발견해서, 이 종류에 단순화된 런치 프로세스를 제공한다. 

충분하지 못한 가치를 제공하거나, 너무 짐이 크다면 프로세스들을 건너뛰게 됨으로,
LCE는 비용과 이득 사이의 올바른 밸런스를 찾기 위해서 지속적으로 런치경험을 최적화 해야 한다. 

## The Lunch Checklist
체크리스트는 실패를 줄이고 다양한 규율의 일관성과 완전성을 보장하기위해 사용된다.
체크리스트의 수는 무한히 늘어날 수 있기 때문에 그 수를 지속적으로 관리해야 한다.
각 항목은 충분히 중요해야 하며 이상적으로는 이전의 런치 재앙과 관련이 있어야 한다.
각 지시는 구체적이고 실용적이며 합리적이어야 한다.
더이상 쓸모없는 항목은 삭제되어야 한다.

## Driving Convergence and Simplification(융합과 단순화를 촉진하기)
큰 조직에서는 개발자가 일반적인 작업에 대해 사용할 수 있는 인프라스트럭쳐를 모르는 경우가 있고, 이는 중복되는 일을 만든다.
공통적인 인프라스트럭처 라이브러리로의 수렴은 중복되는 노력을 없애고, 지식이 서비스간에 쉽게 이동할 수 있도록 하며,
주어진 인프라스트럭쳐에 대한 집중된 관심으로 엔지니어링 및 서비스 품질을 높일 수 있다.

체크리스트를 활용하면 단순화와 융합을 추진시킬 수 있다. 
예를들어 시스템의 빌딩블록으로 체크리스트에 사용량 제한에 시스템x 를 사용하라 라는 항목으로 가이드를 제공할 수 있다.

LCE는 그 경험의 넓이 때문에 단순화의 기회를 포착할 수 있는 포지션에 있다.
여러 런치에서 반복적으로 발생하는 문제 패턴을 찾아 내서 프로세스를 개선할 수도 있고, 인프라 소유자에게 문제를 에스컬레이션 할 수도 있다.

## Launching the Unexpected
만약 프로젝트가 기존 프로젝트 공간과 다른 공간에 위치하면 체크리스트를 스크래치부터 다시 작성해야 할 수 있다.
안드로이드 출시가 이러한 경우였으며, 보이지 않는 이해관계자를 찾아내서 연관시켰다.
런치되는 특별한 프러덕트의 설계와 관련이 없는 구체적인 질문이나 실행항목이 적용되지 않도록 체크리스트 질문항목의 의도를 염두하는 것이 중요하다. 
LCE가 마주하는 일반적이지 않은 런치는 먼저 어떻게 안전한 런치를 실행할지에 대한 첫번째 원리로 돌아가서 체크리스트가 구체적고 유용하도록 전문화 시켜야 한다.

# Developing a Lunch Checklist
재생산 가능한 안정성을 위해서 체크리스트는 중요하다. 회사와 제품에 따라 달라질 수 있다.
구글에서 추려낸 체크리스트의 테마는 다음과 같다.

## Architecture and Dependencies
아키택쳐 검토를 통해서 서비스가 공유인프라를 올바르게 사용하고 있는지 파악하고,
인프라의 소유자를 이해관계자로 포함시킬 수 있다. 빌딩 블록으로 사용되는 내부서비스에 대한 종속성 목록을 확인 할 수 있다.

## Integration
기존 인프라와 통합해야 하는 항목 제공

## Capacity Planning
런칭시 트래픽이 예상의 15배 이상이 되는 경우도 있다.
언론홍보등일정, 런칭후 증가될 트래픽량, 컴퓨티링 리소스가 확보 되었는지에 관한 질문들이 포함될 수 있다.

## Failure Modes
새로운 서비스에 대해서 장애모드를 체계적으로 검토하는 것은, 초반부터 높은 안정성을 보장할 수 있게 한다.
다음과 같은 질문이 포함될 수 있다.
- 설계에 단일 실패지점이 있는지
- 의존성이 사용불가할 경우 이를 어떻게 경감할건지
다음과 같은 조치항목이 포함될 수 있다.
- 장기실행 요청에 의한 리소스 소진을 방지하기 위한 타임아웃 구현
- 과부하 상태에서 리퀘스트 샤딩구현

## Client Behavior
합법적인 유저가 악질적인 행위를 하는 경우는 거의 없지만, 최근에는 다른 앱에 의한 정기적인 동기화,
정기적인 웹사이트의 새로고침등을 고려해야한다.
다음과 같은 조치항목이 포함될 수 있다.
- 클라이언트가 실패시 지수 백오프를 하도록 하라
- 자동 요청에서 요청간에 랜덤 지연 시간(jitter)을 추가하라

## Process and Automation
표준 도구를 사용해서 공통 프로세스를 자동화 하도록 장려하고 있으나, 사람의 손으로 실행되어야 하는 프로세스들이 있다.
자동화 되지 않고 남아있는 프로세스들은 문서화 되어야 한다.
다음과 같은 질문이 포함될 수 있다.
- 서비스를 계속 동작시키기 위해서 수동 프로세스가 있는지
다음과 같은 조치항목이 포함될 수 있다.
- 모든 수동 프로세스를 문서화 하라
- 새 버전을 릴리즈하는 프로세스를 자동화 하라

## Development Process
개발 프로세스에서 버전 관리 시스템을 광범위하게 사용하고 각 릴리즈마다 별도의 브런치를 사용하도록 한다.

## External Dependencies
서드파티 라이브러리나 외부 API 데이터의 의존하는 경우, 이것들을 식별하는게 그것이 수반하는 예측불가능성을 경감시킬 수 있게한다.
다음과 같은 질문이 포함될 수 있다.
- 서비스 런치가 의존하는 서드파티 코드, 데이터, 서비스 이벤트들은 무엇인가
- 서비스에 의존하는 파트너가 있는지, 있다면 알려야 하는지
- 너나 벤더가 런치 데드라인을 맞추지 못하면 어떻게 되는지

## Rollout Planning
대규모 분산시스템에서 동시에 이벤트가 일어나는경우는 거의 없다.
복잡한 런치는 완료될 때까지 몇시간이 걸리는 경우도 있다. 때로는 모든 구성요소가 올바른 순서로 실행되도록 하기 위한 복잡한 절차가 요구되기도 한다.
마케팅 팀이나 홍보와 같은 추가적인 요구사항이 있다면 일이 더 복잡해진다.
컨퍼런스에서 주안점 발표와 같은 이벤트가 있다면 그 전까지 롤아웃이 완료되어야 할 것 이다.

# Selected Techniques for Reliable Launches
## Gradual and Staged Rollouts
구글의 거의 모든 업데이트는 정해진 프로세스에 따라서 점진적으로 진행된다. (서버설치 마저도 그러하다.)
롤아웃의 첫번째 스테이지를 카나리아링 이라고 한다.
Canary testing 은 많은 자동화된 변경을 만드는데 사용되는 구글 내부 툴들에 그 개념이 내장되어 있다.
구글 서버에서 동작하는 소프트웨어뿐만 아니라 새로운 안드로이드앱 같은 경우에도 점진적으로 롤아웃을 한다.
사용자수의 증가를 컨트롤 할 수 있는 추천시스템도 일종의 점진적 롤아웃으로 볼 수 있다.

## Feature Flag Frameworks
테스팅환경이 비현실적이거나 영향의 예측이 힘든경우, 변경사항을 천천히 롤아웃하는 것은
실제 워크로드에서 시스템 동작에 대한 관찰이 가능해지고 이것은 안정성 및 개발 속도에서 이점이 있다.

새로운 기능을 유저가 좋아할지 작은 그룹에 유저에게만 프로토타입을 노출시키고 테스트해보고 싶은 경우가 있다.
이러한 시나리오를 위해서 구글의 프러덕트들은 Feature Flag Frameworks 를 고안했다.
이 프레임워크는 이러한 종류의 출시에 LCE 의 개입이 필요없도록 한다.

## Dealing with Abusive Client Behavior (악의적 유저행동에 대처하기)
악의적인 클라이언트 행동의 가장 간단한 예는 업데이트 빈도다.
60초 마다 동기화 하는 클라이언트는 600초 마다 동기화 하는 클라이언트보다 10배의 부하를 유발한다.
과부하로 요청이 실패했을때, 그 요청의 실패로 계속해서 다시 요청을 하면 상황을 악화시킨다.
이때 클라이언트는 재시도의 빈도를 감소시켜야 한다.
재시도간에 지수 백오프나 지터가 적용되어야 하고, 재시도가 가능한 에러를 구분해야 한다.(500은 재시도가능, 400은 같은 요청은 불가.)

의도적인 동기화 작업은 몰아침 문제를 야기할 수도 있다. 예를들어 2시에 앱 업데이트를 하도록 하면,
일제히 업데이트 요청이 발생하고 이는 문제를 야기할수 있다. 이러한 요청은 랜덤한 시간에 이루어져야 한다.

서버측에서 유저행동을 컨트롤 할 수 있는 능력은 중요하다.
정기적으로 설정을 확인하도록 함으로써 이것을 달성할 수 있다.

예를들어 새로운 기능을 릴리즈할때 설정을 사용해 그것을 on/off 할 수 있으면 위험을 줄일 수 있다.
롤아웃중에 문제가 발생했을 때 출시를 중다하는게 쉬워인다. 설정파일만 변경해서 그 기능을 off 하면 된다.
그렇지 않은 경우에는 모든 유저의 앱을 전부 업데이트 해야 한다.

## Overload Behavior and Load Tests
과부하 상황은 일반적으로 복잡한 실패모드이다.
단순한 모델은 부하가 증가할때 CPU 사용이 증가한다고 가정하지만,
부하 증가에 따른 서비스의 반응은 리니어하지 않으며 어느 지점을 넘어서면 갑자기 문제가 발생한다.
서비스가 과부하에 어떻게 반응할지 사전에 예측하기가 힘들기 때문에 안정성과 용량계획을 위해서라도 부하 테스트가 필요하다.


# Development of LCE
예전에 구글은 매해 엔지니어링 팀이 두배가 되는 시기를 겪었다.
많은 실험적인 새 제품과 기능을 나누어진 엔지니어링팀들이 개발을 했고
프러덕트나 기능을 런치할 때 초보 엔지니어는 그들의 절차 실수를 반복하는 위험을 겪었다.

이전 런치에서 배운 이러한 실수의 반복을 경감 시키기 위해서 소수의 경험 많은 엔지니어가 컨설팅 팀으로 활동했고,
이들은 제품 런치에 대한 체크리스트를 개발했다.

시간이 지나자 이 체크리스트틑 길고 복잡해 졌으며, SRE 조직이 커지면서 제품의 출시 속도에 대해서 제품 개발팀과 충돌하게 되었다.

위와 같은 시나리오를 경감하기 위해서 SRE 엔지니어로 이루어진 LCEs 팀이 만들어졌다.
이들은 제품과 기능의 출시속도를 가속하면서 동시에, SRE의 전문지식을 적용해서 구글의 안정적인 프러덕트 출하를 보증하는 책임을 가졌다.
LCE의 컨설팅 세션은 프러덕션 리뷰로 공식화 되었다.

## Evolution of the LCE Checklist
1500회의 런치에 체크리스트가 사용되었다. LCE 들은 리스크에 따라 런치를 분류하고 다른 체크리스트를 제공하는게 효율적이라는걸 발견했다.
구글의 환경이 커지면서, 예를들어 유투브를 인수하면서 네크워크 인프라를 건설하면서, 많은 런치의 제약사항이 제거되었다.
작은 프러덕트들은 이러한 인프라 상에서 새롭게 네트워크 용량 계획을 세우거나 할 필요가 없어졌다.
대용량 데이터센터가 지어지면서, 대용량이 필요한 큰 프러덕트들의 출시도 간소화 되었다.

## Problems LCE Didn’t Solve
Launch Coordination 이 해결할 수 없는, 자체적인 문제들도 생겨났다.

### Scalability changes
제품이 예상보다 크게 성공하면, 부하를 처리하기 위해 많은 설계변경이 필요하다.
이러한 확장성변경은 지행중인 기능 추가와 결합되고, 프러덕트를 너 복잡하고 부서지기 쉽게, 운영하기 어렵게 만든다.
어느 시점에서 프러덕트는 완전히 재 설계되어야 하고, 기존 유저를 새로운 설계로 마이그레이션하는것은 엄청난 비용이 드는데,
이는 이 기간동안 새로운 기능 개발의 속도가 감소하는 것도 수반된다.


### Growing operational load
서비스가 운영되기 시작한 후에 시스템을 기능하게 하기 위한 반복적인 수동 엔지니어링의 양도 계속 증가하는 경향이 있다.
SRE는 이러한 운영작업을 50% 미만으로 유지하는것을 목표로 하고 있고 이것을 위해서는, 운영 작업의 원인을 추적하고 제거하기 위한 직접적인 노력이 필요하다.

### Infrastructure churn
인프라가 변경되면 인프라 상에서 실행되는 서비스의 소유자는 인프라의 변경을 따라잡기 위해서 많은 작업이 필요하다.
이러한 문제를 해결하려면 인프라 팀에서 새 기능에 대한 마이그레이션을 자동화 할때까지는 후방 호환성을 보증하지 않는 기능을 출시하지 못하도록 하는 것이다.
이렇게 하면 서비스 소유자가 인프라 이탈을 따라잡기위해  수행해야 하는 작업을 최소화 할 수 있다.


# Conclusion
프러덕트에 대한 많은 변경과 함께 급격한 성장을 겪는 회사는 LCE 롤을 장착하는게 유익할 수 있다.
변화 속에서도 안정성이 사용자에게 중요한 경우 특히 유용하다.
런칭이라는 관심사를 전담하는 조직을 만들어서 중복되는 노력을 감소시키고 지식을 통합 발전 시킬 수 있었다.   